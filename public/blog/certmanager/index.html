<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="cert-manager adds certificates and certificate issuers as resource types in Kubernetes clusters, and simplifies the process of obtaining, renewing and using those certificates.">
<meta name="author" content="CloudNativeFolks">

<title>CertManager - Automatically provision and manage TLS certificates in Kubernetes · kubedaily</title>

<link rel="canonical" href="https://kubedaily.com/blog/certmanager/">









<link rel="stylesheet" href="/scss/base.css" integrity="">



<link rel="stylesheet" href="/scss/theme/default.css" integrity="">



  <link rel="preconnect" href="https://-dsn.algolia.net" crossorigin />
  
  <link rel="stylesheet" href="/scss/component/docsearch.css" integrity=""/>

<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/img/icon/favicon.ico">
<link rel="icon" href="/img/icon/icon-16.png" sizes="16x16" type="image/png">
<link rel="icon" href="/img/icon/icon-32.png" sizes="32x32" type="image/png">
<link rel="apple-touch-icon" href="/img/icon/icon-180.png" sizes="180x180">
<script async src="https://www.googletagmanager.com/gtag/js?id="></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', '');
</script>
    <script 
     src="https://cdn.jsdelivr.net/npm/quizdown@latest/public/build/quizdown.js">
  </script>
  <script 
      src="https://cdn.jsdelivr.net/npm/quizdown@latest/public/build/extensions/quizdownKatex.js">
  </script>
  <script 
      src="https://cdn.jsdelivr.net/npm/quizdown@latest/public/build/extensions/quizdownHighlight.js">
  </script>
  <script>quizdown.register(quizdownHighlight).register(quizdownKatex).init()</script> 
  </head>
  <body>
    <header id="site-header">
  
  <div id="site-header-brand">
    <a href="/">kubedaily</a>
  </div>

  
  <div id="site-header-controls">
    
    <div class="dropdown">
      <button class="dropdown-btn" aria-haspopup="menu" aria-label="theme selector">
        <i class="icon icon-brightness"></i>
        <i class="icon icon-select"></i>
      </button>
      <ul role="menu" class="dropdown-menu">
        <li role="menuitem"><button class="color-scheme" data-value="light"><i class="icon icon-light-mode"></i> Light</button></li>
        <li role="menuitem"><button class="color-scheme" data-value="dark"><i class="icon icon-dark-mode"></i> Dark &nbsp;</button></li>
        <li role="menuitem"><button class="color-scheme" data-value="night"><i class="icon icon-night-mode"></i> Night</button></li>
      </ul>
    </div>

    
    <div class="dropdown">
      <button class="dropdown-btn" aria-haspopup="menu" aria-label="language selector">
        <i class="icon icon-translate"></i>
        <i class="icon icon-select"></i>
      </button>
      <ul role="menu" class="dropdown-menu">
        
          <li role="menuitem"><a href="#">English</a></li>
        
      </ul>
    </div>
  </div>

  
  <div id="site-header-menu">
    <nav>
      <ul>
        
        
        
          
          <li><a href="/" ><i class='icon icon-home'></i>Home</a></li>
        
          
          <li><a href="/docker/" ><i class='icon icons8-docker '></i>Docker</a></li>
        
          
          <li><a href="/containersecurity/" ><i class='icon icon-book'></i>ContainerSecurity</a></li>
        
          
          <li><a href="/k8s/" ><i class='icon icons8-kubernetes'></i>Kubernetes</a></li>
        
          
          <li><a href="/blog/"  class="active"><i class='icon icon-book'></i>blog</a></li>
        
          
          <li><a href="https://kubedaily.com/cloudnativetools/" ><i class='icon icon-book'></i>cloudnativetools</a></li>
        
      </ul>
    </nav>
  </div>

  

</header>
    
<nav id="article-nav">
  <button id="article-nav-menu-btn"><i class="icon icon-menu"></i> On this section</button>
  <button id="article-nav-toc-btn"><i class="icon icon-toc"></i> On this page</button>
</nav>
<header id="article-header">
  <h1>CertManager - Automatically provision and manage TLS certificates in Kubernetes</h1>
</header>

<section class="hero is-primary is-bold is-medium">
  <div class="hero-body">
    <div class="container">
      <div class="docs-content">
        <p class="title is-size-1 is-size-2-mobile is-spaced">
          CertManager - Automatically provision and manage TLS certificates in Kubernetes
        </p>
      </div>

      
      
      <p class="subtitle is-size-3 is-size-4-mobile">
        Sangam Biradar | February 14, 2023
      </p>
      
    </div>
  </div>
</section>

<div id="article-content">
    
    
    


<center> <a href="https://github.com/cert-manager/cert-manager"><img src="https://github-link-card.s3.ap-northeast-1.amazonaws.com/cert-manager/cert-manager.png" width="460px" target="_blank"></a> </center>

<h3 id="start-minikube">Start Minikube</h3>
<pre tabindex="0"><code>minikube-certmanager git:(main) minikube start
😄  minikube v1.30.0 on Darwin 13.3.1 (arm64)
✨  Using the docker driver based on existing profile
👍  Starting control plane node minikube in cluster minikube
🚜  Pulling base image ...
🏃  Updating the running docker &#34;minikube&#34; container ...
❗  Image was not built for the current minikube version. To resolve this you can delete and recreate your minikube cluster using the latest images. Expected minikube version: v1.29.0 -&gt; Actual minikube version: v1.30.0
🐳  Preparing Kubernetes v1.26.3 on Docker 23.0.2 ...
🔎  Verifying Kubernetes components...
    ▪ Using image gcr.io/k8s-minikube/storage-provisioner:v5
🌟  Enabled addons: storage-provisioner, default-storageclass
🏄  Done! kubectl is now configured to use &#34;minikube&#34; cluster and &#34;default&#34; namespace by default
</code></pre><h3 id="add-jetstack-helm">add jetstack helm</h3>
<pre tabindex="0"><code>➜  minikube-certmanager git:(main) helm repo add jetstack https://charts.jetstack.io  
&#34;jetstack&#34; has been added to your repositories
</code></pre><h3 id="update-helm-charts">update helm charts</h3>
<pre tabindex="0"><code>➜  minikube-certmanager git:(main) helm repo update
Hang tight while we grab the latest from your chart repositories...
...Successfully got an update from the &#34;jetstack&#34; chart repository
Update Complete. ⎈Happy Helming!⎈
</code></pre><h3 id="install-cert-manger-crd-on-test-namespace">Install cert-manger CRD on test namespace</h3>
<pre tabindex="0"><code>➜  minikube-certmanager git:(main) helm install \
    cert-manager jetstack/cert-manager \
    --namespace test \
    --create-namespace \
    --version v1.11.1 \
    --set installCRDs=true
NAME: cert-manager
LAST DEPLOYED: Fri Apr 14 12:35:31 2023
NAMESPACE: test
STATUS: deployed
REVISION: 1
TEST SUITE: None
NOTES:
cert-manager v1.11.1 has been deployed successfully!

In order to begin issuing certificates, you will need to set up a ClusterIssuer
or Issuer resource (for example, by creating a &#39;letsencrypt-staging&#39; issuer).

More information on the different types of issuers and how to configure them
can be found in our documentation:

https://cert-manager.io/docs/configuration/

For information on how to configure cert-manager to automatically provision
Certificates for Ingress resources, take a look at the `ingress-shim`
documentation:

https://cert-manager.io/docs/usage/ingress/
</code></pre><h3 id="verify-test-namespace-is-active">verify test namespace is active</h3>
<pre tabindex="0"><code>➜  minikube-certmanager git:(main) kubectl get ns
NAME              STATUS   AGE
default           Active   16h
kube-node-lease   Active   16h
kube-public       Active   16h
kube-system       Active   16h
test              Active   4m31s
</code></pre><h3 id="create-self-signered-certificate-issuer">create self-signered certificate issuer</h3>
<p>creating a self-signed certificate that our CA will use. To do so we will first need to create a self-signed certificate issuer.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yml" data-lang="yml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">cert-manager.io/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Issuer</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">selfsigned-issuer</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">test</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selfSigned</span><span class="p">:</span><span class="w"> </span>{}<span class="w">
</span></span></span></code></pre></div><h3 id="kubectl-apply-cert-manager-ss-issuer">kubectl apply cert manager ss issuer</h3>
<pre tabindex="0"><code>minikube-certmanager git:(main) ✗ kubectl create -f cert-manager-ss-issuer.yaml
issuer.cert-manager.io/selfsigned-issuer created
</code></pre><h3 id="creat-ca-certificate">creat CA certificate</h3>
<pre tabindex="0"><code>apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  name: test-ca
  namespace: test
spec:
  isCA: true
  commonName: test-ca
  subject:
    organizations:
    - ACME Inc.
    organizationalUnits:
    - Widgets
  secretName: test-ca-secret
  privateKey:
    algorithm: ECDSA
    size: 256
  issuerRef:
    name: selfsigned-issuer
    kind: Issuer
    group: cert-manager.io
</code></pre><h3 id="kubectl-apply--cert-manager-ca-cert">kubectl apply  cert-manager-ca-cert</h3>
<pre tabindex="0"><code>➜  minikube-certmanager git:(main) ✗ kubectl create -f cert-manager-ca-cert.yaml
certificate.cert-manager.io/test-ca created
</code></pre><h3 id="checkt-it-out-certificate">checkt it out certificate</h3>
<pre tabindex="0"><code>➜  minikube-certmanager git:(main) ✗ kubectl -n test get certificate
NAME      READY   SECRET           AGE
test-ca   True    test-ca-secret   4m15s
</code></pre><h3 id="check-it-out-secrets">check it out secrets</h3>
<pre tabindex="0"><code>➜  minikube-certmanager git:(main) ✗ kubectl -n test get secret test-ca-secret
NAME             TYPE                DATA   AGE
test-ca-secret   kubernetes.io/tls   3      5m1s
</code></pre><p>Excellent! This secret contains the ca.crt, tls.crt, and tls.key that belong to the CA itself.</p>
<h3 id="create-ca-issuer">create ca issuer</h3>
<p>Now it’s time to create our CA issuer. Create a file called cert-manager-ca-issuer.yaml with the following:</p>
<pre tabindex="0"><code>apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  name: test-ca-issuer
  namespace: test
spec:
  ca:
    secretName: test-ca-secret
</code></pre><h3 id="apply-ca-issuer">apply ca issuer</h3>
<pre tabindex="0"><code>➜  minikube-certmanager git:(main) ✗ kubectl create -f cer
t-manager-ca-issuer.yaml 
issuer.cert-manager.io/test-ca-issuer created
</code></pre><h3 id="test-ca-cert">test ca cert</h3>
<pre tabindex="0"><code>apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  name: test-server
  namespace: test
spec:
  secretName: test-server-tls
  isCA: false
  usages:
  - server auth
  - client auth
  dnsNames:
  - &#34;test-server.test.svc.cluster.local&#34;
  - &#34;test-server&#34;
  issuerRef:
    name: test-ca-issuer
---
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  name: test-client
  namespace: test
spec:
  secretName: test-client-tls
  isCA: false
  usages:
  - server auth
  - client auth
  dnsNames:
  - &#34;test-client.test.svc.cluster.local&#34;
  - &#34;test-client&#34;
  issuerRef:
    name: test-ca-issuer
</code></pre><h3 id="test-server-cert">test server cert</h3>
<pre tabindex="0"><code>➜  minikube-certmanager git:(main) ✗ kubectl create -f test-server-cert.yaml
certificate.cert-manager.io/test-server created
certificate.cert-manager.io/test-client created
</code></pre><h3 id="verify-ca-with-openssl">verify CA with Openssl</h3>
<pre tabindex="0"><code>➜  minikube-certmanager git:(main) ✗ openssl verify -CAfile \
&lt;(kubectl -n test get secret test-ca-secret -o jsonpath=&#39;{.data.ca\.crt}&#39; | base64 -d) \
&lt;(kubectl -n test get secret test-server-tls -o jsonpath=&#39;{.data.tls\.crt}&#39; | base64 -d)
/dev/fd/16: OK
/dev/fd/13: OK
</code></pre><h3 id="start-openssl-server-get-secrets-tls">start openssl server get secrets tls</h3>
<pre tabindex="0"><code>
minikube-certmanager git:(main) ✗ echo Hello World! &gt; test.txt
minikube-certmanager git:(main) ✗ openssl s_server \
  -cert &lt;(kubectl -n test get secret test-server-tls -o jsonpath=&#39;{.data.tls\.crt}&#39; | base64 -d) \
  -key &lt;(kubectl -n test get secret test-server-tls -o jsonpath=&#39;{.data.tls\.key}&#39; | base64 -d) \
  -CAfile &lt;(kubectl -n test get secret test-server-tls -o jsonpath=&#39;{.data.ca\.crt}&#39; | base64 -d) \
  -WWW -port 12345  \
  -verify_return_error -Verify 1
verify depth is 1, must return a certificate
Using auto DH parameters
ACCEPT
</code></pre><h3 id="verify-certificate-working">verify certificate working</h3>
<pre tabindex="0"><code> ➜  minikube-certmanager git:(main) ✗ echo -e &#39;GET /test.txt HTTP/1.1\r\n\r\n&#39; | \
  openssl s_client \
  -cert &lt;(kubectl -n test get secret test-client-tls -o jsonpath=&#39;{.data.tls\.crt}&#39; | base64 -d) \
  -key &lt;(kubectl -n test get secret test-client-tls -o jsonpath=&#39;{.data.tls\.key}&#39; | base64 -d) \
  -CAfile &lt;(kubectl -n test get secret test-client-tls -o jsonpath=&#39;{.data.ca\.crt}&#39; | base64 -d) \
  -connect localhost:12345 -quiet
depth=1 O = ACME Inc., OU = Widgets, CN = test-ca
verify return:1
depth=0 
verify return:1
HTTP/1.0 200 ok
Content-type: text/plain

Hello World!
</code></pre><h3 id="enable-ingress-on-minikube">enable ingress on minikube</h3>
<pre tabindex="0"><code>➜  minikube-certmanager git:(main) ✗ minikube addons enable ingress
💡  ingress is an addon maintained by Kubernetes. For any concerns contact minikube on GitHub.
You can view the list of minikube maintainers at: https://github.com/kubernetes/minikube/blob/master/OWNERS
💡  After the addon is enabled, please run &#34;minikube tunnel&#34; and your ingress resources would be available at &#34;127.0.0.1&#34;
    ▪ Using image registry.k8s.io/ingress-nginx/kube-webhook-certgen:v20230312-helm-chart-4.5.2-28-g66a760794
    ▪ Using image registry.k8s.io/ingress-nginx/controller:v1.7.0
    ▪ Using image registry.k8s.io/ingress-nginx/kube-webhook-certgen:v20230312-helm-chart-4.5.2-28-g66a760794
🔎  Verifying ingress addon...
🌟  The &#39;ingress&#39; addon is enabled
</code></pre><h3 id="echo-server-setup-with-ca-signed-certificate">Echo Server Setup with CA Signed Certificate</h3>
<pre tabindex="0"><code>apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: echo
  name: echo
  namespace: test
spec:
  replicas: 1
  selector:
    matchLabels:
      app: echo
  template:
    metadata:
      labels:
        app: echo
    spec:
      containers:
      - name: echo
        image: fdeantoni/echo-server
        imagePullPolicy: Always
        ports:
        - containerPort: 9000
        readinessProbe:
          httpGet:
            path: /
            port: 9000
          initialDelaySeconds: 5
          periodSeconds: 5
          successThreshold: 1
---
apiVersion: v1
kind: Service
metadata:
  name: echo-service
  namespace: test
spec:
  selector:
    app: echo
  ports:
  - name: http
    protocol: TCP
    port: 9000
    targetPort: 9000
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: echo-ingress
  namespace: test
  annotations:
    cert-manager.io/issuer: test-ca-issuer
spec:
  rules:
  - http:
      paths:
      - path: /test
        pathType: Prefix
        backend:
          service:
            name: echo-service
            port:
              number: 9000
tls:
- hosts:
  - echo.info
  secretName: echo-cert
</code></pre><h3 id="deploy-echo-service">deploy echo service</h3>
<pre tabindex="0"><code>➜  minikube-certmanager git:(main) ✗ kubectl create -f echo-server.yaml
deployment.apps/echo created
service/echo-service created
</code></pre><h3 id="start-minikube-tunnel">start minikube tunnel</h3>
<pre tabindex="0"><code>➜  minikube-certmanager git:(main) ✗ minikube tunnel
✅  Tunnel successfully started

📌  NOTE: Please do not close this terminal as this process must stay alive for the tunnel to be accessible ...
</code></pre><h3 id="echo-service-works-with-our-ca-signed-certificate">echo service works with our CA signed certificate.</h3>
<pre tabindex="0"><code>➜  minikube-certmanager git:(main) ✗ curl --cacert &lt;(kubectl -n test get secret echo-server-cert -o jsonpath=&#39;{.data.ca\.crt}&#39; | base64 -d) https://echo.info/test
&#34;source&#34;:&#34;172.17.0.7:42246&#34;,&#34;method&#34;:&#34;GET&#34;,&#34;headers&#34;:[[&#34;host&#34;,&#34;echo.info&#34;],[&#34;x-request-id&#34;,&#34;6e0035387cfa6be8c53a3e03e73e9f23&#34;],[&#34;x-real-ip&#34;,&#34;172.17.0.1&#34;],[&#34;x-forwarded-for&#34;,&#34;172.17.0.1&#34;],[&#34;x-forwarded-host&#34;,&#34;echo.info&#34;],[&#34;x-forwarded-port&#34;,&#34;443&#34;],[&#34;x-forwarded-proto&#34;,&#34;https&#34;],[&#34;x-forwarded-scheme&#34;,&#34;https&#34;],[&#34;x-scheme&#34;,&#34;https&#34;],[&#34;user-agent&#34;,&#34;curl/7.79.1&#34;],[&#34;accept&#34;,&#34;*/*&#34;]],&#34;path&#34;:&#34;/test&#34;,&#34;server&#34;:&#34;echo-6885c7cfdc-8phts&#34;}
</code></pre><h2 id="source-code">source code</h2>


<center>
<a href="https://github.com/sangam14/minikube-certmanager"><img src="https://github-link-card.s3.ap-northeast-1.amazonaws.com/sangam14/minikube-certmanager.png" width="460px" target="_blank"></a> </center>

<p>Join <a href="https://discord.gg/rEvr7vq">CloudNativeFolks Community</a> or Reach out to me on twitter <a href="https://twitter.com/sangamtwts" target="_blank">@sangamtwts</a></p>

  </div>
<aside id="toc">
  <span class="btn-close"><i class="icon icon-close"></i></span>
  <div class="sticky">
    <strong><i class="icon icon-toc"></i> On this page</strong>
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#start-minikube">Start Minikube</a></li>
        <li><a href="#add-jetstack-helm">add jetstack helm</a></li>
        <li><a href="#update-helm-charts">update helm charts</a></li>
        <li><a href="#install-cert-manger-crd-on-test-namespace">Install cert-manger CRD on test namespace</a></li>
        <li><a href="#verify-test-namespace-is-active">verify test namespace is active</a></li>
        <li><a href="#create-self-signered-certificate-issuer">create self-signered certificate issuer</a></li>
        <li><a href="#kubectl-apply-cert-manager-ss-issuer">kubectl apply cert manager ss issuer</a></li>
        <li><a href="#creat-ca-certificate">creat CA certificate</a></li>
        <li><a href="#kubectl-apply--cert-manager-ca-cert">kubectl apply  cert-manager-ca-cert</a></li>
        <li><a href="#checkt-it-out-certificate">checkt it out certificate</a></li>
        <li><a href="#check-it-out-secrets">check it out secrets</a></li>
        <li><a href="#create-ca-issuer">create ca issuer</a></li>
        <li><a href="#apply-ca-issuer">apply ca issuer</a></li>
        <li><a href="#test-ca-cert">test ca cert</a></li>
        <li><a href="#test-server-cert">test server cert</a></li>
        <li><a href="#verify-ca-with-openssl">verify CA with Openssl</a></li>
        <li><a href="#start-openssl-server-get-secrets-tls">start openssl server get secrets tls</a></li>
        <li><a href="#verify-certificate-working">verify certificate working</a></li>
        <li><a href="#enable-ingress-on-minikube">enable ingress on minikube</a></li>
        <li><a href="#echo-server-setup-with-ca-signed-certificate">Echo Server Setup with CA Signed Certificate</a></li>
        <li><a href="#deploy-echo-service">deploy echo service</a></li>
        <li><a href="#start-minikube-tunnel">start minikube tunnel</a></li>
        <li><a href="#echo-service-works-with-our-ca-signed-certificate">echo service works with our CA signed certificate.</a></li>
      </ul>
    </li>
    <li><a href="#source-code">source code</a></li>
  </ul>
</nav>
  </div>
</aside>

    <footer id="site-footer">
  
  <div id="site-footer-copyright">
    <a href="https://discord.gg/rEvr7vq" target="_blank">
      <i class="icon icon-copyright"></i> 2023 CloudNativeFolks
    </a>
  </div>

  
  <div id="site-footer-social">

    

    
    <a href="https://twitter.com/i/communities/1499311438745468931" target="_blank" aria-label="twitter url">
      <i class="icon icon-twitter icon-colored"></i>
    </a>
    

    
    <a href="https://github.com/sangam14" target="_blank" aria-label="github url">
      <i class="icon icon-github icon-colored"></i>
    </a>
    

    
    <a href="https://www.youtube.com/@CloudNativeFolks" target="_blank" aria-label="youtube url">
      <i class="icon icon-youtube icon-colored"></i>
    </a>
    

  </div>

  
  <center> <a href="https://visitorbadge.io/status?path=https%3A%2F%2Fkubedaily.com"><img src="https://api.visitorbadge.io/api/visitors?path=https%3A%2F%2Fkubedaily.com&label=KubeDaily&labelColor=%232ccce4&countColor=%2337d67a" /></a> </center> 

  
  <div id="site-footer-love">
    Made with <i class="icon icon-love icon-colored"></i> &nbsp;from&nbsp;<a href="https://blog.cloudnativefolks.org" target="_blank">@CloudNativeFollks</a>
  </div>
</footer>
    






<script type="text/javascript" src="/js/base.min.js"></script>



  
  <script src="/js/component/docsearch.min.js"></script>
  <script type="application/javascript">
      docsearch({
          container: '#site-header-search',
          appId: '',
          indexName: '',
          apiKey: '',
      });
  </script>


<script type="application/javascript">
    if('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/sw.js?2023-12-06')
            .catch(function(err) {console.error('ServiceWorker registration failed: ', err);});
    }
</script>
  </body>
</html>